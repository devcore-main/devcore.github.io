<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - DEV-CORE</title>
    <link rel="stylesheet" href="reset-password.css">
</head>
<body>

    <header>
        <h1>Reset Password</h1>
        <p>Set your new password below</p>
    </header>

    <div class="auth-container">
        <div class="auth-card">
            <h2>New Password</h2>
            <p class="auth-subtitle">Please enter your new password</p>

            <form id="resetForm" method="POST" action="/reset-password">
                <div class="form-group">
                    <label for="password">New Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter new password" required>
                    <span class="error-message" id="passwordError"></span>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm new password" required>
                    <span class="error-message" id="confirmPasswordError"></span>
                </div>

                <!-- ===== reCAPTCHA ===== -->
                <div class="form-group">
                    <div class="g-recaptcha" data-sitekey="6LepaiYsAAAAANXnV8jxioJLaWFNeVwgO5M9ciot"></div>
                    <span class="error-message" id="recaptchaError"></span>
                </div>

                <button type="submit" class="btn-submit" id="submitBtn">
                    <span class="btn-text">Reset Password</span>
                    <span class="btn-loader" style="display:none;">⏳</span>
                </button>

                <div class="form-message" id="formMessage"></div>
            </form>

            <div class="auth-footer">
                <p>Remembered your password? <a href="login.html">Login here</a></p>
                <p>Don't have an account? <a href="signup.html">Sign up here</a></p>
            </div>
        </div>
    </div>

    <footer>
        <ul>
            <li><a target="_blank" href="mailto:devcore.communicate@gmail.com">Email</a></li>
            <li><a target="_blank" href="tel:+966359797419">Telephone</a></li>
            <li><a target="_blank" href="https://www.instagram.com/dev.core.egy">Instagram</a></li>
        </ul>
    </footer>

    <script src="../js/auth.js"></script>
    <script src="../js/local.js"></script>
    <!-- Google reCAPTCHA -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <script>
        const resetForm = document.getElementById('resetForm');
        const submitBtn = document.getElementById('submitBtn');
        const formMessage = document.getElementById('formMessage');

        resetForm.addEventListener('submit', async e => {
            e.preventDefault();

            const password = document.getElementById('password').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            // تحقق من تطابق الباسوردات
            if(password !== confirmPassword){
                formMessage.className = 'form-message error';
                formMessage.textContent = 'Passwords do not match';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-text').style.display = 'none';
            submitBtn.querySelector('.btn-loader').style.display = 'inline-block';
            formMessage.style.display = 'none';

            const token = new URLSearchParams(window.location.search).get('token');

            try {
                const res = await fetch(resetForm.action, {
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body: JSON.stringify({ password, token })
                });

                const data = await res.json();

                if(res.ok){
                    formMessage.className = 'form-message success';
                    formMessage.textContent = 'Password has been reset successfully!';
                } else {
                    formMessage.className = 'form-message error';
                    formMessage.textContent = data.message || 'Failed to reset password';
                }

            } catch(err){
                formMessage.className = 'form-message error';
                formMessage.textContent = 'Network error';
            }

            submitBtn.disabled = false;
            submitBtn.querySelector('.btn-text').style.display = 'inline-block';
            submitBtn.querySelector('.btn-loader').style.display = 'none';
        });
    </script>
    <script> 
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script> 
</body>
</html>